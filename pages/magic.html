<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="icon" href="assets/ico/favicon.ico">
    <link rel="stylesheet" href="assets/css/rouge-base16-dark.css">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/starter-template.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
  </head>

  <body>
    <div id="container" class="container">

      <h3>The Magic Box</h3>

      <script>
      function submitcode()
        {
          console.log($('#magic-box').val());
          $.ajax({ 
            type:'post',
            url:'scripts/validate.rb',
            data: '{ "lang": "' + $('#lang').val() + '", "code": "' + encodeURI($('#magic-box').val()) + '" }',
            dataType:'json',
            success: function(res) {
              console.log(res)
              $('#output').attr('rows', res['message'].length+2);
              $('#output').val(res['message'].join("\n"));
              if (res['exitcode'] == 0) {
                $('#status').removeClass('text-danger');
                $('#status').addClass('text-success');
                $('#status').html('success');
                $('#status').show('fast');
              } else {
                $('#status').removeClass('text-success');
                $('#status').addClass('text-danger');
                $('#status').html('failure');
                $('#status').show('fast');
              }
            }
        });
      }
      </script>

      <form id='magic' action='#'>
        <div class='form-group'>
          <label for='magic-box'>Enter puppet code:</label>
          <textarea class='form-control' id='magic-box' rows='5'></textarea>
        </div>
        <div class='form-inline'>
          <label for='lang'>Language:</label>
          <select class='custom-select' id='lang'>
            <option value='puppet' selected>puppet</option>
            <option value='ruby'>ruby</option>
            <option value='yaml'>yaml</option>
            <option value='json'>json</option>
          </select>
        </div>
      </form>
        <p><button onclick='submitcode();' class='btn btn-primary'>Test</button></p>
      <form>
        <div class='form-inline'>
          <label for='output'>Status:</label> <span id='status' hidden>success</span>
        </div>
        <div class='form-group'>
          <samp><textarea class='form-control' id='output' rows='5' readonly></textarea></samp>
        </div>
      </form>


    </div>
  </body>
</html>
